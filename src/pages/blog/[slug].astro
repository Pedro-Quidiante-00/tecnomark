---
import Layout from '../../layouts/Layout.astro';
import { PUBLIC_STRAPI_URL } from '../../lib/conections';

export async function getStaticPaths() {
    const response = await fetch(`${PUBLIC_STRAPI_URL}/posts?populate=*`);
    const { data } = await response.json();
    const noticias = data || [];

    return noticias.map((item: any) => ({
        params: { slug: item.slug },
        props: { post: item },
    }));
}

const { post } = Astro.props as any;
const categoriaNombre = post.categoria?.nombre || 'Blog';
---

<Layout title={post.titulo}>

    {/* ---- FOTO DE FONDO ---- */}
    <div class="w-full h-[400px] md:h-[500px] relative">
        <img
                src={post.cover?.url || '/placeholder.png'}
                alt={post.titulo}
                class="w-full h-full object-cover"
        />
        {/* ---- Sombra suave negra ---- */}
        <div class="absolute inset-0 bg-black/40"></div>
    </div>

    {/* ---- TARJETA FLOTANTE ---- */}
    <article class="max-w-4xl bg-white relative z-10 -mt-32 mb-20 p-6 md:p-12 rounded-xl shadow-2xl mx-auto md:mx-auto">

        {/* ---- Navegación ---- */}
        <div class="flex justify-between items-center mb-6 border-b border-gray-200 pb-4">
            <a href="/blog" class="font-lectura text-gray-950 hover:text-black transition-colors font-bold text-sm">
                Volver
            </a>
            <span class="font-lectura bg-gray-100 text-gray-950 px-3 py-1 rounded text-xs font-bold uppercase tracking-wide">
                {categoriaNombre}
            </span>
        </div>

        {/* ---- Encabezado ---- */}
        <header class="mb-8 text-center">
            {/* ---- Título ---- */}
            <h1 class="text-3xl font-titulo md:text-5xl font-black text-gray-950 mb-4 leading-tight">
                {post.titulo}
            </h1>

            {/* ---- Subtítulo en Open Sans ---- */}
            {post.subtitulo && (
                    <p class="font-lectura text-lg text-gray-950 mt-4">
                        {post.subtitulo}
                    </p>
            )}
        </header>

        {/* ---- Contenido ---- */}
        <div class="text-gray-950">

            {/* ---- Resumen ---- */}
            <div class="bg-gray-50 p-6 rounded-lg mb-8 border-l-4 border-gray-300">
                <p class="font-lectura text-lg italic text-gray-950">
                    {post.resumen}
                </p>
            </div>

            {/* ---- Texto principal ---- */}
            <div class="font-lectura whitespace-pre-line text-lg leading-loose px-2 md:px-4 text-gray-950">
                {post.contenido}
            </div>

        </div>

    </article>

</Layout>